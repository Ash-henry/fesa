{% comment %}
  Product Feature Accordion Section
  Displays collapsible content panels with smooth animations
{% endcomment %}

<div class="color-{{ section.settings.color_scheme }}">
    <div class="accordion-container-{{ section.id }}" style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
        <div class="accordion-wrapper-{{ section.id }}">
            {% if section.settings.heading != blank %}
                <h2 class="accordion-heading-{{ section.id }}">{{ section.settings.heading }}</h2>
            {% endif %}

            {% if section.settings.description != blank %}
                <p class="accordion-description-{{ section.id }}">{{ section.settings.description }}</p>
            {% endif %}

            <div class="accordion-items-{{ section.id }}">
                {% for block in section.blocks %}
                    <div class="accordion-item-{{ section.id }}" data-block-id="{{ block.id }}" {{ block.shopify_attributes }}>
                        <button
                                class="accordion-button-{{ section.id }} {% if block.settings.default_open %}active{% endif %}"
                                aria-expanded="{% if block.settings.default_open %}true{% else %}false{% endif %}"
                                data-accordion-trigger
                        >
                            <span class="accordion-title-{{ section.id }}">{{ block.settings.title }}</span>
                            <span class="accordion-icon-{{ section.id }}">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
                        </button>
                        <div class="accordion-content-{{ section.id }} {% if block.settings.default_open %}active{% endif %}">
                            <div class="accordion-content-inner-{{ section.id }}">
                                {% if block.settings.image != blank %}
                                    <div class="accordion-image-{{ section.id }}">
                                        {{ block.settings.image | image_url: width: 800 | image_tag: loading: 'lazy', alt: block.settings.image.alt }}
                                    </div>
                                {% endif %}
                                <div class="accordion-text-{{ section.id }}">
                                    {{ block.settings.content }}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
    .accordion-container-{{ section.id }} {
        width: 100%;
        background: rgb(var(--color-background));
        color: rgb(var(--color-foreground));
    }

    .accordion-wrapper-{{ section.id }} {
        max-width: {{ section.settings.container_width }}px;
        margin: 0 auto;
        padding: 0 20px;
    }

    .accordion-heading-{{ section.id }} {
        font-size: {{ section.settings.heading_size }}px;
        font-weight: 600;
        margin: 0 0 16px 0;
        color: rgb(var(--color-foreground));
        text-align: {{ section.settings.text_align }};
    }

    .accordion-description-{{ section.id }} {
        font-size: 16px;
        line-height: 1.6;
        margin: 0 0 32px 0;
        color: rgba(var(--color-foreground), 0.7);
        text-align: {{ section.settings.text_align }};
    }

    .accordion-items-{{ section.id }} {
        display: flex;
        flex-direction: column;
        gap: {{ section.settings.item_spacing }}px;
    }

    .accordion-item-{{ section.id }} {
        border: 1px solid rgba(var(--color-foreground), {{ section.settings.border_opacity | divided_by: 100.0 }});
        border-radius: {{ section.settings.border_radius }}px;
        overflow: hidden;
        background: rgb(var(--color-background));
        transition: all 0.3s ease;
    }

    .accordion-item-{{ section.id }}:hover {
        border-color: rgba(var(--color-foreground), {{ section.settings.border_opacity | divided_by: 100.0 | plus: 0.2 }});
    }

    .accordion-button-{{ section.id }} {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: {{ section.settings.button_padding }}px;
        background: transparent;
        border: none;
        cursor: pointer;
        text-align: left;
        color: rgb(var(--color-foreground));
        font-size: {{ section.settings.title_size }}px;
        font-weight: 500;
        transition: background-color 0.3s ease;
    }

    .accordion-button-{{ section.id }}:hover {
        background: rgba(var(--color-foreground), 0.05);
    }

    .accordion-title-{{ section.id }} {
        flex: 1;
    }

    .accordion-icon-{{ section.id }} {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        flex-shrink: 0;
        transition: transform 0.3s ease;
    }

    .accordion-button-{{ section.id }}.active .accordion-icon-{{ section.id }} {
        transform: rotate(180deg);
    }

    .accordion-content-{{ section.id }} {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .accordion-content-{{ section.id }}.active {
        max-height: 2000px;
    }

    .accordion-content-inner-{{ section.id }} {
        padding: 0 {{ section.settings.button_padding }}px {{ section.settings.button_padding }}px;
    }

    .accordion-image-{{ section.id }} {
        margin-bottom: 16px;
        border-radius: 8px;
        overflow: hidden;
    }

    .accordion-image-{{ section.id }} img {
        width: 100%;
        height: auto;
        display: block;
    }

    .accordion-text-{{ section.id }} {
        font-size: 15px;
        line-height: 1.7;
        color: rgba(var(--color-foreground), 0.8);
    }

    .accordion-text-{{ section.id }} p {
        margin: 0 0 16px 0;
    }

    .accordion-text-{{ section.id }} p:last-child {
        margin-bottom: 0;
    }

    .accordion-text-{{ section.id }} ul,
    .accordion-text-{{ section.id }} ol {
        margin: 0 0 16px 0;
        padding-left: 24px;
    }

    .accordion-text-{{ section.id }} li {
        margin-bottom: 8px;
    }

    @media (max-width: 768px) {
        .accordion-heading-{{ section.id }} {
            font-size: {{ section.settings.heading_size | times: 0.75 }}px;
        }

        .accordion-button-{{ section.id }} {
            font-size: {{ section.settings.title_size | times: 0.9 }}px;
            padding: {{ section.settings.button_padding | times: 0.75 }}px;
        }

        .accordion-content-inner-{{ section.id }} {
            padding: 0 {{ section.settings.button_padding | times: 0.75 }}px {{ section.settings.button_padding | times: 0.75 }}px;
        }
    }
</style>

<script>
    (function() {
        const accordionItems = document.querySelectorAll('[data-accordion-trigger]');

        accordionItems.forEach(button => {
            button.addEventListener('click', function() {
                const item = this.closest('.accordion-item-{{ section.id }}');
                const content = item.querySelector('.accordion-content-{{ section.id }}');
                const isActive = this.classList.contains('active');

                {% if section.settings.allow_multiple %}
                // Allow multiple items to be open
                if (isActive) {
                    this.classList.remove('active');
                    content.classList.remove('active');
                    this.setAttribute('aria-expanded', 'false');
                } else {
                    this.classList.add('active');
                    content.classList.add('active');
                    this.setAttribute('aria-expanded', 'true');
                }
                {% else %}
                // Only allow one item to be open at a time
                const allButtons = document.querySelectorAll('.accordion-item-{{ section.id }} [data-accordion-trigger]');
                const allContents = document.querySelectorAll('.accordion-item-{{ section.id }} .accordion-content-{{ section.id }}');

                allButtons.forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-expanded', 'false');
                });
                allContents.forEach(cnt => cnt.classList.remove('active'));

                if (!isActive) {
                    this.classList.add('active');
                    content.classList.add('active');
                    this.setAttribute('aria-expanded', 'true');
                }
                {% endif %}
            });
        });
    })();
</script>

{% schema %}
{
  "name": "Product Accordion",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Product Features"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Learn more about our product features and specifications"
    },
    {
      "type": "select",
      "id": "text_align",
      "label": "Text Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "range",
      "id": "container_width",
      "min": 600,
      "max": 1400,
      "step": 50,
      "unit": "px",
      "label": "Container Width",
      "default": 1000
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Top Spacing",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Bottom Spacing",
      "default": 60
    },
    {
      "type": "range",
      "id": "item_spacing",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Space Between Items",
      "default": 12
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Heading Size",
      "default": 36
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Item Title Size",
      "default": 18
    },
    {
      "type": "header",
      "content": "Style Settings"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Border Radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "border_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Border Opacity",
      "default": 15
    },
    {
      "type": "range",
      "id": "button_padding",
      "min": 12,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Item Padding",
      "default": 24
    },
    {
      "type": "header",
      "content": "Behavior"
    },
    {
      "type": "checkbox",
      "id": "allow_multiple",
      "label": "Allow Multiple Items Open",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "accordion_item",
      "name": "Accordion Item",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Feature Title"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Add your detailed content here. You can include lists, paragraphs, and more.</p>"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image (Optional)"
        },
        {
          "type": "checkbox",
          "id": "default_open",
          "label": "Open by Default",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Accordion",
      "blocks": [
        {
          "type": "accordion_item",
          "settings": {
            "title": "What's Included",
            "content": "<p>Our product includes everything you need to get started. High-quality materials, detailed instructions, and lifetime support.</p>"
          }
        },
        {
          "type": "accordion_item",
          "settings": {
            "title": "Product Specifications",
            "content": "<ul><li>Dimensions: 10\" x 8\" x 4\"</li><li>Weight: 2.5 lbs</li><li>Materials: Premium aluminum and recycled plastic</li><li>Colors: Available in 5 colors</li></ul>"
          }
        },
        {
          "type": "accordion_item",
          "settings": {
            "title": "Shipping & Returns",
            "content": "<p>Free shipping on orders over $50. Easy 30-day returns with no questions asked. We stand behind our products 100%.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
