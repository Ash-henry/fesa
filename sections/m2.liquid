<div class="marquee-section" data-marquee-speed="{{ section.settings.speed }}" data-marquee-direction="{{ section.settings.direction }}">
    <div class="marquee-container">
        <div class="marquee-content" id="marquee-content">
            {% for block in section.blocks %}
                {% case block.type %}
                    {% when 'text' %}
                        {%- comment -%} Added link support for text items {%- endcomment -%}
                        <span class="marquee-item marquee-text">
              {% if block.settings.link != blank %}
                  <a href="{{ block.settings.link }}" class="marquee-link">{{ block.settings.text }}</a>
              {% else %}
                  {{ block.settings.text }}
              {% endif %}
            </span>
                    {% when 'image' %}
                        {%- comment -%} Added link support for image items {%- endcomment -%}
                        <span class="marquee-item marquee-image">
              {% if block.settings.link != blank %}
                  <a href="{{ block.settings.link }}" class="marquee-link">
                  <img src="{{ block.settings.image | img_url: '100x' }}" alt="{{ block.settings.image.alt }}" loading="lazy">
                </a>
              {% else %}
                  <img src="{{ block.settings.image | img_url: '100x' }}" alt="{{ block.settings.image.alt }}" loading="lazy">
              {% endif %}
            </span>
                    {% when 'icon' %}
                        {%- comment -%} Added link support for icon items {%- endcomment -%}
                        <span class="marquee-item marquee-icon">
              {% if block.settings.link != blank %}
                  <a href="{{ block.settings.link }}" class="marquee-link">{{ block.settings.icon_code }}</a>
              {% else %}
                  {{ block.settings.icon_code }}
              {% endif %}
            </span>
                {% endcase %}
            {% endfor %}
        </div>
        <div class="marquee-content marquee-duplicate" aria-hidden="true">
            {% for block in section.blocks %}
                {% case block.type %}
                    {% when 'text' %}
                        <span class="marquee-item marquee-text">
              {% if block.settings.link != blank %}
                  <a href="{{ block.settings.link }}" class="marquee-link">{{ block.settings.text }}</a>
              {% else %}
                  {{ block.settings.text }}
              {% endif %}
            </span>
                    {% when 'image' %}
                        <span class="marquee-item marquee-image">
              {% if block.settings.link != blank %}
                  <a href="{{ block.settings.link }}" class="marquee-link">
                  <img src="{{ block.settings.image | img_url: '100x' }}" alt="{{ block.settings.image.alt }}" loading="lazy">
                </a>
              {% else %}
                  <img src="{{ block.settings.image | img_url: '100x' }}" alt="{{ block.settings.image.alt }}" loading="lazy">
              {% endif %}
            </span>
                    {% when 'icon' %}
                        <span class="marquee-item marquee-icon">
              {% if block.settings.link != blank %}
                  <a href="{{ block.settings.link }}" class="marquee-link">{{ block.settings.icon_code }}</a>
              {% else %}
                  {{ block.settings.icon_code }}
              {% endif %}
            </span>
                {% endcase %}
            {% endfor %}
        </div>
    </div>
</div>

<style>
    .marquee-section {
        width: 100%;
        overflow: hidden;
    {%- comment -%} Added support for color scheme {%- endcomment -%}
        background-color: {{ section.settings.color_scheme.settings.background }};
        padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
    }

    .marquee-container {
        display: flex;
        white-space: nowrap;
        width: fit-content;
    }

    .marquee-content {
        display: flex;
        align-items: center;
        gap: {{ section.settings.gap }}px;
        animation: marquee-scroll var(--marquee-speed) linear infinite;
        animation-direction: var(--marquee-direction);
    }

    .marquee-duplicate {
        margin-left: {{ section.settings.gap }}px;
    }

    .marquee-item {
        display: inline-flex;
        align-items: center;
        flex-shrink: 0;
    }

    .marquee-text {
        font-size: {{ section.settings.font_size }}px;
    {%- comment -%} Using color scheme for text color {%- endcomment -%}
        color: {{ section.settings.color_scheme.settings.text }};
        font-weight: {{ section.settings.font_weight }};
        text-transform: {{ section.settings.text_transform }};
    }

    {%- comment -%} Added link styling {%- endcomment -%}
    .marquee-link {
        color: inherit;
        text-decoration: none;
        transition: opacity 0.2s ease;
    }

    .marquee-link:hover {
        opacity: 0.7;
    }

    .marquee-image img {
        height: {{ section.settings.image_height }}px;
        width: auto;
        object-fit: contain;
    }

    .marquee-icon {
        font-size: {{ section.settings.icon_size }}px;
    {%- comment -%} Using color scheme for icon color {%- endcomment -%}
        color: {{ section.settings.color_scheme.settings.text }};
    }

    @keyframes marquee-scroll {
        0% {
            transform: translateX(0);
        }
        100% {
            transform: translateX(-100%);
        }
    }

    {% if section.settings.pause_on_hover %}
    .marquee-section:hover .marquee-content {
        animation-play-state: paused;
    }
    {% endif %}
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const marqueeSection = document.querySelector('.marquee-section');
        const speed = marqueeSection.dataset.marqueeSpeed;
        const direction = marqueeSection.dataset.marqueeDirection;

        marqueeSection.style.setProperty('--marquee-speed', speed + 's');
        marqueeSection.style.setProperty('--marquee-direction', direction);
    });
</script>

{% schema %}
{
  "name": "M2",
  "settings": [
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "range",
      "id": "speed",
      "min": 5,
      "max": 100,
      "step": 5,
      "unit": "s",
      "label": "Animation Speed",
      "default": 20,
      "info": "Lower is faster"
    },
    {
      "type": "select",
      "id": "direction",
      "label": "Direction",
      "options": [
        {
          "value": "normal",
          "label": "Left to Right"
        },
        {
          "value": "reverse",
          "label": "Right to Left"
        }
      ],
      "default": "normal"
    },
    {
      "type": "checkbox",
      "id": "pause_on_hover",
      "label": "Pause on hover",
      "default": true
    },
    {
      "type": "header",
      "content": "Styling"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "font_size",
      "min": 12,
      "max": 72,
      "step": 2,
      "unit": "px",
      "label": "Font Size",
      "default": 24
    },
    {
      "type": "select",
      "id": "font_weight",
      "label": "Font Weight",
      "options": [
        { "value": "300", "label": "Light" },
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "600"
    },
    {
      "type": "select",
      "id": "text_transform",
      "label": "Text Transform",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "uppercase", "label": "Uppercase" },
        { "value": "lowercase", "label": "Lowercase" },
        { "value": "capitalize", "label": "Capitalize" }
      ],
      "default": "uppercase"
    },
    {
      "type": "range",
      "id": "gap",
      "min": 10,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Gap Between Items",
      "default": 50
    },
    {
      "type": "range",
      "id": "image_height",
      "min": 20,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Image Height",
      "default": 60
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 12,
      "max": 72,
      "step": 4,
      "unit": "px",
      "label": "Icon Size",
      "default": 32
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 20
    }
  ],
  "blocks": [
    {
      "type": "text",
      "name": "Text Item",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Your text here"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (optional)"
        }
      ]
    },
    {
      "type": "image",
      "name": "Image Item",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (optional)"
        }
      ]
    },
    {
      "type": "icon",
      "name": "Icon Item",
      "settings": [
        {
          "type": "html",
          "id": "icon_code",
          "label": "Icon HTML/SVG",
          "info": "Paste SVG code or HTML entity"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (optional)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "M2",
      "blocks": [
        {
          "type": "text",
          "settings": {
            "text": "FREE SHIPPING ON ORDERS OVER $50"
          }
        },
        {
          "type": "text",
          "settings": {
            "text": "★"
          }
        },
        {
          "type": "text",
          "settings": {
            "text": "NEW ARRIVALS EVERY WEEK"
          }
        },
        {
          "type": "text",
          "settings": {
            "text": "★"
          }
        }
      ]
    }
  ]
}
{% endschema %}
